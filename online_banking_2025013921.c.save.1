include <stdlib.h>
include <string.h>

define FILE_NAME "accounts.txt"

typedef struct {
    char fullname[50];
    char accountNumber[20];
    char password[20];
    double balance;
} Account;

int isLoggedIn = 0;

/******************** UTILITY FUNCTIONS ************************/

int accountExists(char *accNum) {
    FILE *fp = fopen(FILE_NAME, "r");
    if (!fp) return 0;

    Account acc;
    while (fscanf(fp, "%[^|]|%[^|]|%[^|]|%lf\n",
                  acc.fullname, acc.accountNumber, acc.password, &acc.balance) != EOF) {
        if (strcmp(acc.accountNumber, accNum) == 0) {
            fclose(fp);
            return 1;
        }
    }
    fclose(fp);
    return 0;
}

Account getAccount(char *accNum) {
    FILE *fp = fopen(FILE_NAME, "r");
    Account acc;

    while (fscanf(fp, "%[^|]|%[^|]|%[^|]|%lf\n",
                  acc.fullname, acc.accountNumber, acc.password, &acc.balance) != EOF) {
        if (strcmp(acc.accountNumber, accNum) == 0) {
            fclose(fp);
            return acc;
        }
    }

    fclose(fp);
    return acc;
}

void updateAccount(Account acc) {
    FILE *fp = fopen(FILE_NAME, "r");
    FILE *temp = fopen("temp.txt", "w");

    Account a;
    while (fscanf(fp, "%[^|]|%[^|]|%[^|]|%lf\n",
                  a.fullname, a.accountNumber, a.password, &a.balance) != EOF) {
        if (strcmp(a.accountNumber, acc.accountNumber) == 0) {
            fprintf(temp, "%s|%s|%s|%.2lf\n",
                    acc.fullname, acc.accountNumber, acc.password, acc.balance);
        } else {
            fprintf(temp, "%s|%s|%s|%.2lf\n",
                    a.fullname, a.accountNumber, a.password, a.balance);
        }
    }

    fclose(fp);
    fclose(temp);

    remove(FILE_NAME);
    rename("temp.txt", FILE_NAME);
}

/******************** CORE FEATURES ************************/

int generateAccountNumber() {
    FILE *fp = fopen(FILE_NAME, "r");
    int num = 1000;
    Account acc;

    if (!fp) return 1001;

    while (fscanf(fp, "%[^|]|%[^|]|%[^|]|%lf\n",
                  acc.fullname, acc.accountNumber, acc.password, &acc.balance) != EOF) {
        int x = atoi(acc.accountNumber);
        if (x > num) num = x;
    }

    fclose(fp);
    return num + 1;
}

void registerAccount() {
    FILE *fp = fopen(FILE_NAME, "a");
    Account acc;

    printf("Enter Full Name: ");
    getchar();
    fgets(acc.fullname, sizeof(acc.fullname), stdin);
    acc.fullname[strcspn(acc.fullname, "\n")] = 0;

    sprintf(acc.accountNumber, "%d", generateAccountNumber());
    printf("Generated Account Number: %s\n", acc.accountNumber);

    printf("Create Password: ");
    scanf("%s", acc.password);

    printf("Initial Deposit (K): ");
    scanf("%lf", &acc.balance);

    fprintf(fp, "%s|%s|%s|%.2lf\n",
            acc.fullname, acc.accountNumber, acc.password, acc.balance);

    fclose(fp);

    printf("\nAccount created successfully!\n");
}

void login() {
    char accNum[20], pass[20];

    printf("Enter Account Number: ");
    scanf("%s", accNu
